---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

```{r}
# Turn off scientific notation
options(scipen=999)

# Load the tidyverse. Ensure the tidyverse is already installed outside of the script
library(tidyverse)
library(tidytext)
library(janitor)
library(lubridate)
library(tidycensus)
```

```{r echo=FALSE}
# Set Census API key
census_api_key("03183f1d7157fca8529a26898cff8c1b802565ed", overwrite=TRUE)
```

```{r}
# Load the core datasets
county_2024 <- read_csv("data/earlyvote_county_24.csv")
county_2020 <- read_csv("data/earlyvote_county_20.csv")
county_2016 <- read_csv("data/earlyvote_county_16.csv")

early_voting_16 <- read_csv("data/2016_EarlyVoting_RAW_data.csv")
early_voting_20 <- read_csv("data/2020_EarlyVoting_RAW_data.csv")
early_voting_2024 <- read_csv("data/2024_EarlyVoting_RAW_data.csv")

party_24 <- read_csv("data/earlyvoting_party.csv")

```

2016 data has 104,046 rows and 19 columns
2020 data has 209,983 rows and 19 columns 
2024 data has 160,472 rows and 19 columns

In terms of time frame, we have access to the General Election data from 2016, 2020 and 2024, which will allow us to explore the change in early voting over different election cycles. Because we have access to different time frames of data, there aren't any looming limits for the data. Some of our questions reference demographics, (ie "How do economic factors like household income and unemployment rates impact early voter voter turnout across Maryland counties?" and "Are certain counties or demographic groups turning out in higher numbers for early voting compared to previous elections?") and the data set does include some demographic data, including gender, political party affiliation and age group, we do lack other common demographics such as race, household income and unemployment rates. What we may have to do is locate that demographic data from individual counties and compare it to the early voting data we have now. 

#Most newsworhty thing about the data so far.
Change in early voting from 2020 to 2024: -7.504786 %
Change in early voting from 2016 to 2020: 44.98002 %
Change in early voting from 2016 to 2024: 27.02911 %

There was an obvious jump in early voting from 2016 to 2020, I assume due to the pandemic. However I assumed that early voting levels would level back out to 2016 numbers, but it seems that they remain high, with a 27% increase from 2016 to 2024 and only a 7.5% decrease from 2020. 

Also the three counties with the highest percentage of early voters, all fell in the top 5 for lowest unemployment rate 
#2 Talbot	Unemploymet: 3.173432		early voter: 32.80	
#3Calvert	Unemploymet 3.180552		early voter 33.65	
#5 Queen Anne's	Unemploymet 3.633084		early voter 33.87	

#Question 4: How does early voting turnout correlate with registered party affiliation across Maryland counties? 

#Answer 4: Democratic counties have more Democratic early voters, and Republican counties show the opposite. This matches typical voting patterns.

```{r}
early_voting_2024 |> 
  clean_names() |>  
  group_by(county_name) |> 
  summarise(
    total_voters = n(),
    dem = sum(party_code == "DEM", na.rm = TRUE),
    rep = sum(party_code == "REP", na.rm = TRUE),
    oth = sum(party_code == "OTH", na.rm = TRUE),
    una = sum(party_code == "UNA", na.rm = TRUE),
    lib = sum(party_code == "LIB", na.rm = TRUE)
  ) |>  
  mutate(
    percent_dem = (dem / total_voters) * 100,
    percent_rep = (rep / total_voters) * 100
  ) |> 
  arrange(desc(percent_dem))

```

#Question 3: Are certain counties turning out in higher numbers for early voting compared to previous elections? 

#Answer 3: Calvert County’s early voting increased by 60% from 2020 to 2024, and Washington County’s rose 40%. Washington saw the largest growth since 2016, with a 100% increase.

```{r}
# Clean names for county_2024
county_2024_clean <- county_2024 |> 
  clean_names() |> 
  select(county_name, percent_total) |> 
  mutate(percent_total = as.numeric(str_replace(percent_total, "%", ""))) |> 
  rename(percent_total_24 = percent_total)

# Clean names for county_2020
county_2020_clean <- county_2020 |> 
  clean_names() |> 
  select(county, percent_total) |> 
  mutate(percent_total = as.numeric(str_replace(percent_total, "%", ""))) |> 
  rename(percent_total_20 = percent_total, county_name = county)

# Clean names for county_2016
county_2016_clean <- county_2016 |> 
  clean_names() |> 
  select(county_name, percent_total) |> 
  mutate(percent_total = as.numeric(str_replace(percent_total, "%", ""))) |> 
  rename(percent_total_16 = percent_total)

# Combine the cleaned datasets
q_3_final <- county_2024_clean |> 
  left_join(county_2020_clean, by = "county_name") |> 
  left_join(county_2016_clean, by = "county_name") |> 
  mutate(
    percent_change_24_20 = ((percent_total_24 - percent_total_20) / percent_total_20) * 100,
    percent_change_24_16 = ((percent_total_24 - percent_total_16) / percent_total_16) * 100,
    percent_change_20_16 = ((percent_total_20 - percent_total_16) / percent_total_16) * 100
  ) |> 
  arrange(desc(percent_change_24_16))

q_3_final


  # this final table, depending on how you arrange, will answer question  3. From 2020 to 2024 there are two counties experiencing a major increase of the total percent of eligible voters who voted early. Calvert (nearly 60% change) and Washington (40% change). Washington County is quite interesting, as it has the highest net increase, as from 2016 to 2024, it's percentage of early voters increase by almost exactly 100%. 

```

#Question 1: What is the percentage change of early voters from an election prior to covid (or 2020) to after covid? 

#Answer 1: Early voting increased by 27% from 2016 to 2024, showing lasting changes from pandemic-era voting. Turnout dipped slightly (-7.5%) from 2020 to 2024 but stayed much higher than 2016. This is quite similar to question three. You can look at the percent change for each county, but here is the total percent change 

```{r}
total_percent_changes <- q_3_final |> 
  summarise(
    avg_change_24_20 = mean(percent_change_24_20, na.rm = TRUE),
    avg_change_24_16 = mean(percent_change_24_16, na.rm = TRUE),
    avg_change_20_16 = mean(percent_change_20_16, na.rm = TRUE)
  )

total_percent_changes

```

#Question 5: How do economic factors like median income and unemployment rates impact early voter turnout across Maryland counties?

#Answer 5: Counties with lower unemployment and higher incomes have higher early voting turnout. Economic stability appears to encourage voter participation.

```{r}
md_data <- get_acs(
  geography = "county",
  variables = c(
    unemployment = "B23025_005",
    labor_force = "B23025_003",
    median_income = "B19013_001"
  ),
  state = "MD",
  year = 2022,
  geometry = FALSE
) |> 
  rename(county_name = NAME) |> 
  mutate(
    county_name = gsub(" County, Maryland", "", county_name),
    county_name = gsub("^Baltimore$", "Baltimore County", county_name),
    county_name = gsub("Baltimore city, Maryland", "Baltimore City", county_name),
    unemployment_rate = (unemployment / labor_force) * 100
  ) |> 
  select(county_name, unemployment_rate, median_income)

q_5_final <- md_data |> 
  left_join(county_2024_clean, by = "county_name") |> 
  arrange(unemployment_rate)

q_5_final

```

#Question 2: What is the relationship between the proportion of eligible voters and early voter turnout in recent elections, and how do demographics explain differences across counties?

#Answer 2: Counties with more eligible voters tend to have higher early voting turnout. Demographics like income, unemployment, and party affiliation also explain differences between counties. Demographics like education don't explain the differences differences between counties as much as expected.

```{r}
md_data_2 <- get_acs(
  geography = "county",
  variables = c(
    total_pop_over_25 = "B15003_001",
    no_school = "B15003_002",
    highschool = "B15003_017",
    bachelor = "B15003_021",
    masters = "B15003_023",
    pro_school_degree = "B15003_024",
    doctorate = "B15003_025"
  ),
  state = "MD",
  year = 2022,
  geometry = FALSE
) |> 
  rename(county_name = NAME) |> 
  mutate(
    county_name = gsub(" County, Maryland", "", county_name),
    county_name = gsub("^Baltimore$", "Baltimore County", county_name),
    county_name = gsub("Baltimore city, Maryland", "Baltimore City", county_name),
    bachelor_pct = (bachelor / total_pop_over_25) * 100,
    doctorate_pct = (doctorate / total_pop_over_25) * 100,
    highschool_pct = (highschool / total_pop_over_25) * 100,
    masters_pct = (masters / total_pop_over_25) * 100,
    pro_school_degree_pct = (pro_school_degree / total_pop_over_25) * 100,
    no_school_pct = (no_school / total_pop_over_25) * 100
  ) |> 
  select(GEOID, county_name, no_school_pct, pro_school_degree_pct, masters_pct, highschool_pct, doctorate_pct, bachelor_pct)

q_2_final <- md_data_2 |> 
  left_join(county_2024_clean, by = "county_name") |> 
  select(county_name, percent_total_24, no_school_pct, pro_school_degree_pct, masters_pct, highschool_pct, doctorate_pct, bachelor_pct) |> 
  arrange(desc(percent_total_24))

q_2_final

```

